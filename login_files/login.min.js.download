var locamail=locamail||{},grecaptcha=grecaptcha||{};locamail.login=function(a){"use strict";function i(){a("#back-to-webmail-button").on("click",function(){rcmail.redirect("./?_task=login")})}function o(){var i="./?_task=login&_action=plugin.LocawebForgotPassword.preForgotPassword";a(f.forgotPasswordButton).on("click",function(){locamail.login._addRecaptcha(i)})}function e(a){grecaptcha.execute(rcmail.env.recaptcha_site_key_v3,{action:"pre_forgot_password"}).then(function(i){a+="&_token="+i,rcmail.redirect(a)},function(){rcmail.log("Error on Recaptcha v3"),rcmail.redirect(a)})}function n(){a("#preforgotpasswordform").on("submit",function(){var i=a("#rcmloginuser"),o=i.val();rcmail.env.domain&&!l(o)&&i.val(o+"@"+rcmail.env.domain)})}function r(){a("#backloginpage").on("click",function(){var a="./?_task=login";rcmail.redirect(a)})}function l(a){return/^[a-z0-9_\-\.]{1,}@[a-z0-9_\-\.]{1,}\.[a-z]{1,}(\*[a-z_\-\.]{1,})*$/.test(a)}function t(){a.validator.methods.email=function(a,i){return this.optional(i)||l(a)},a("#loginform").validate({errorClass:"redborder",errorPlacement:function(a,i){a.addClass("errormessage"),"_user"===i.attr("name")?a.insertAfter("#userid"):"_pass"===i.attr("name")?a.insertAfter("#pwdid"):a.insertAfter(i)},highlight:function(i,o){"rcmloginuser"===i.id&&a("#userid").addClass(o),"rcmloginpwd"===i.id&&a("#pwdid").addClass(o)},unhighlight:function(i,o){"rcmloginuser"===i.id&&a("#userid").removeClass(o),"rcmloginpwd"===i.id&&a("#pwdid").removeClass(o)},wrapper:"span",rules:{_user:{required:{depends:function(){return a(this).val(a.trim(a(this).val())),!0}},email:!rcmail.env.domain},_pass:{required:!0}},messages:{_user:{required:rcmail.labels["locamail_translate.emptyemail"],email:rcmail.labels["locamail_translate.wrongdomain"]},_pass:{required:rcmail.labels["locamail_translate.emptypass"]}}})}function s(){"block"===a(".lm-login-banner").css("display")?(a(".lm-login-container").removeClass("no-banner").addClass("banner"),a(".lm-logo-label").removeClass("lm-hide")):a(".lm-login-container").removeClass("banner").addClass("no-banner")}function c(){rcmail.env.domain&&(a(".lm-login-has-advertsing").removeClass("lm-login-has-advertsing"),a("#login-advertising-section").remove())}function m(){var i=a(".item-bar").hasClass("strong"),o=a("#recover-password-submit");o.attr("disabled","disabled"),i&&o.removeAttr("disabled")}function d(){rcmail.addEventListener("plugin.changeSaveButton",locamail.login.changeSaveButton)}function g(){a("#resend-token-button").on("click",function(){a(this).addClass("lm-hide"),a("#wait-receive-token").removeClass("lm-hide"),rcmail.http_post("plugin.LocawebForgotPassword.resendTokenEmail",{_email:rcmail.env.email_user})})}function u(){a("#alternativeemail, #uncknowemail").on("click",function(){a("#recover-pass").removeAttr("disabled")})}function v(){locaweb_utils.togglePassword(a("#showpass")),locamail.login._goToForgotPassword(),locamail.login._goBackLoginPage(),locamail.login._redirectToLogin(),locamail.login._verifyHasBanner(),locamail.login._submitForgotPassword(),locamail.login._removeAdvertsingFromDomain(),locamail.login._addEventListeners(),locamail.login.resendToken(),locamail.login.clickAlternativeEmailRadio()}var f,_=null;return f={forgotPasswordButton:"#forgotpass"},a(document).ready(function(){t()}),a("#submitloginform").on("click",function(i){a("#loginform").validate(),_=a("#loginform").valid(),_||i.preventDefault()}),{init:v,changeSaveButton:m,resendToken:g,clickAlternativeEmailRadio:u,_addRecaptcha:e,_isEmail:l,_goToForgotPassword:o,_goBackLoginPage:r,_redirectToLogin:i,_verifyHasBanner:s,_submitForgotPassword:n,_removeAdvertsingFromDomain:c,_addEventListeners:d}}(jQuery),rcmail.addEventListener("init",function(){locamail.login.init()});